{% extends "admin/change_form.html" %}

{% block breadcrumbs %}{% endblock %}
{% block nav-breadcrumbs %}{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <style>
    /* Página do Post: limpa o topo (breadcrumbs) e dá um ar mais "editor" */
    body.model-post.change-form .content-header,
    body.model-post.change-form .breadcrumb,
    body.model-post.change-form .breadcrumbs {
      display: none !important;
    }

    body.model-post.change-form #content {
      padding-top: 14px;
    }

    .oxira-editor-tip {
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(220,38,38,.04);
      border-radius: 14px;
      padding: 14px 16px;
      margin-bottom: 14px;
    }
    .oxira-editor-tip strong { font-weight: 900; }
    .oxira-editor-tip .muted { color: rgba(107,114,128,.95); }

    /* Tooltip "?" (mesmo estilo do dashboard) */
    .oxira-help {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      margin-left: 6px;
      border-radius: 999px;
      border: 1px solid rgba(107, 114, 128, .35);
      color: rgba(107, 114, 128, .95);
      font-weight: 900;
      font-size: 10px;
      line-height: 1;
      cursor: help;
      user-select: none;
      position: relative;
      top: -1px;
      z-index: 9999;
    }

    .oxira-help:hover {
      border-color: rgba(220, 38, 38, .55);
      color: rgba(220, 38, 38, 1);
      background: rgba(220, 38, 38, .08);
    }

    .oxira-help[data-tip]::after {
      content: attr(data-tip);
      position: absolute;
      left: 50%;
      top: -10px;
      transform: translate(-50%, -100%);
      background: rgba(255, 255, 255, .98);
      color: rgba(17, 24, 39, .96);
      border: 1px solid rgba(0,0,0,.08);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 12px;
      font-weight: 650;
      letter-spacing: 0;
      text-transform: none;
      width: max-content;
      max-width: 360px;
      white-space: normal;
      box-shadow: 0 18px 45px rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .12s ease;
      z-index: 100000;
    }

    .oxira-help[data-tip]::before {
      content: "";
      position: absolute;
      left: 50%;
      top: -10px;
      transform: translate(-50%, -2px);
      border: 6px solid transparent;
      border-top-color: rgba(255, 255, 255, .98);
      filter: drop-shadow(0 2px 0 rgba(0,0,0,.06));
      opacity: 0;
      pointer-events: none;
      transition: opacity .12s ease;
      z-index: 100001;
    }

    .oxira-help:hover::after,
    .oxira-help:hover::before {
      opacity: 1;
    }

    /* Evita o tooltip ser cortado por containers com overflow */
    body.model-post.change-form .card,
    body.model-post.change-form .module,
    body.model-post.change-form fieldset.module {
      overflow: visible !important;
    }

    /* Deixa labels mais “editor” */
    body.model-post.change-form label {
      font-weight: 800;
    }

    /* ===== Visual clean/moderno (apenas Post) ===== */
    body.model-post.change-form .oxira-editor-tip {
      background: #fff;
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 8px 24px rgba(0,0,0,.04);
    }

    /* Cards/fieldsets mais leves */
    body.model-post.change-form .card,
    body.model-post.change-form .module,
    body.model-post.change-form fieldset.module {
      border-radius: 16px !important;
      border: 1px solid rgba(0,0,0,.06) !important;
      box-shadow: 0 10px 28px rgba(0,0,0,.04) !important;
      overflow: hidden;
    }

    body.model-post.change-form .card-header,
    body.model-post.change-form .module h2,
    body.model-post.change-form fieldset.module > h2 {
      border-bottom: 1px solid rgba(0,0,0,.06) !important;
      background: #fff !important;
    }

    /* Mata aquele “gradeado”/linhas entre campos */
    body.model-post.change-form .form-row {
      border-bottom: 0 !important;
      padding-bottom: 0 !important;
      margin-bottom: 14px !important;
    }

    /* Layout: label em cima do campo, tudo mais compacto */
    body.model-post.change-form .aligned .form-row,
    body.model-post.change-form .form-row {
      display: flex !important;
      flex-direction: column !important;
      align-items: stretch !important;
      gap: 6px;
    }

    body.model-post.change-form .form-row > div,
    body.model-post.change-form .form-row .fieldBox,
    body.model-post.change-form .form-row .flex-container {
      float: none !important;
      width: 100% !important;
      max-width: 100% !important;
    }

    body.model-post.change-form label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: rgba(17, 24, 39, .92);
      margin: 0 !important;
      padding: 0 !important;
    }

    body.model-post.change-form .help,
    body.model-post.change-form .helptext,
    body.model-post.change-form .form-row .help,
    body.model-post.change-form .form-row .helptext {
      margin-top: 6px !important;
      color: rgba(107,114,128,.95) !important;
      font-size: 12px !important;
    }

    /* Inputs modernos */
    body.model-post.change-form input[type="text"],
    body.model-post.change-form input[type="number"],
    body.model-post.change-form input[type="url"],
    body.model-post.change-form input[type="email"],
    body.model-post.change-form input[type="search"],
    body.model-post.change-form input[type="datetime-local"],
    body.model-post.change-form input.vTextField,
    body.model-post.change-form select,
    body.model-post.change-form textarea {
      width: 100% !important;
      max-width: 100% !important;
      padding: 12px 14px !important;
      border-radius: 12px !important;
      border: 1px solid rgba(0,0,0,.12) !important;
      background: #fff !important;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }

    body.model-post.change-form input::placeholder,
    body.model-post.change-form textarea::placeholder {
      color: rgba(156,163,175,.95);
    }

    body.model-post.change-form input[type="text"]:focus,
    body.model-post.change-form input[type="number"]:focus,
    body.model-post.change-form input[type="url"]:focus,
    body.model-post.change-form input[type="email"]:focus,
    body.model-post.change-form input[type="search"]:focus,
    body.model-post.change-form input[type="datetime-local"]:focus,
    body.model-post.change-form input.vTextField:focus,
    body.model-post.change-form select:focus,
    body.model-post.change-form textarea:focus {
      outline: none !important;
      border-color: rgba(220,38,38,.65) !important;
      box-shadow: 0 0 0 4px rgba(220,38,38,.12) !important;
    }

    /* raw_id_fields (Autor) mais amigável */
    body.model-post.change-form .related-widget-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
      width: 100%;
      flex-wrap: wrap;
    }
    body.model-post.change-form .related-widget-wrapper input {
      flex: 1 1 220px;
      min-width: 180px;
    }
    body.model-post.change-form .related-widget-wrapper a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 42px;
      padding: 0 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.12);
      background: #fff;
      color: rgba(17,24,39,.9);
      font-weight: 800;
      text-decoration: none;
    }
    body.model-post.change-form .related-widget-wrapper a:hover {
      border-color: rgba(220,38,38,.35);
      background: rgba(220,38,38,.05);
      color: rgba(220,38,38,1);
    }

    /* CKEditor: borda/raio alinhados ao resto */
    body.model-post.change-form .cke {
      border-radius: 16px !important;
      border: 1px solid rgba(0,0,0,.10) !important;
      overflow: hidden;
      box-shadow: 0 10px 28px rgba(0,0,0,.04) !important;
    }
    body.model-post.change-form .cke_top {
      background: #fff !important;
      border-bottom: 1px solid rgba(0,0,0,.06) !important;
    }
    body.model-post.change-form .cke_contents {
      background: #fff !important;
    }

    /* Mobile: deixa o editor utilizável (de quebra-galho) */
    @media (max-width: 640px) {
      /* Evita "scroll duplo" e cortes horizontais */
      body.model-post.change-form #content {
        padding-left: 12px;
        padding-right: 12px;
      }

      /* Campos e widgets sempre 100% */
      body.model-post.change-form .form-row,
      body.model-post.change-form .aligned,
      body.model-post.change-form .fieldBox,
      body.model-post.change-form .form-row .fieldBox,
      body.model-post.change-form .form-row .flex-container,
      body.model-post.change-form .form-row input,
      body.model-post.change-form .form-row select,
      body.model-post.change-form .form-row textarea {
        max-width: 100% !important;
      }

      /* CKEditor: container 100% */
      body.model-post.change-form .django-ckeditor-widget,
      body.model-post.change-form .cke,
      body.model-post.change-form .cke_inner,
      body.model-post.change-form .cke_contents,
      body.model-post.change-form .cke_contents iframe {
        width: 100% !important;
        max-width: 100% !important;
      }

      /* CKEditor: toolbar quebra linha e botões maiores */
      body.model-post.change-form .cke_top {
        padding: 8px 8px 6px !important;
      }
      body.model-post.change-form .cke_toolbox {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 6px 8px !important;
      }
      body.model-post.change-form .cke_toolbar {
        float: none !important;
        margin: 0 !important;
      }
      body.model-post.change-form .cke_combo,
      body.model-post.change-form .cke_toolbar_group {
        margin: 0 !important;
      }
      body.model-post.change-form .cke_button,
      body.model-post.change-form .cke_combo_button {
        padding: 7px 8px !important;
      }
      body.model-post.change-form .cke_button_icon {
        transform: scale(1.05);
      }

      /* Área de edição com altura boa no mobile */
      body.model-post.change-form .cke_contents {
        min-height: 360px !important;
      }

      /* Tooltips: não estoura na tela pequena */
      .oxira-help[data-tip]::after {
        max-width: min(320px, calc(100vw - 24px));
      }
    }
  </style>
{% endblock %}

{% block form_top %}
  <div class="oxira-editor-tip">
    <strong>Hora de escrever.</strong>
    <span class="muted">Dica rápida: título chama clique, subtítulo segura o leitor e conteúdo entrega a promessa (sem enrolação, claro).</span>
  </div>
  {{ block.super }}
{% endblock %}

{% block admin_change_form_document_ready %}
  {{ block.super }}
  <script>
    (function () {
      const tips = {
        title: "Aqui vai o seu TÍTULO (o grandão). Aparece na home/lista e lá em cima na matéria. Ex: \"IA no Varejo: como as lojas estão virando laboratório\". Capricha: é a primeira coisa que o povo vê.",
        subtitle: "SUBTÍTULO é o teaser: uma frase curtinha pra dar contexto e vontade de clicar. Ex: \"Do caixa ao estoque, a tecnologia está mudando tudo — e rápido.\"",
        slug: "SLUG é o endereço da matéria (URL). Ele vira o link. Ex: \"ia-no-varejo-tecnologia-personalizando\". Dica: sem acento, sem espaços, tudo com hífen.",
        author: "AUTOR é quem assina a matéria. Vai aparecer perto do título e também na página do perfil do autor. Normalmente já vem como você (e só admin consegue trocar).",
        content: "CONTEÚDO é o texto da matéria (o que a pessoa vai ler). Aqui vale: subtítulo, intertítulos, links e imagens. Pense: \"começo forte\", \"meio com dados\", \"final com conclusão\".",
        image: "IMAGEM DESTACADA é a capa da matéria (upload). Ela aparece na home/listas e no topo da matéria. Tamanho recomendado: 1280×720 (16:9). Use JPG/WEBP e evite imagem pequena pra não pixelar.",
        category: "CATEGORIA é o canal da matéria (Esportes, Política...). Ela aparece como etiqueta perto do título e organiza o site.",
        status: "STATUS controla se a matéria aparece no site. \n• Rascunho: só você vê.\n• Em revisão: pra ajustar antes de publicar.\n• Publicado: no ar.\n• Agendado: publica na data/hora escolhida.",
        published_date: "DATA DE PUBLICAÇÃO é quando a matéria deve entrar no ar (ou aparecer como publicada). Ex: agendar pra amanhã 08:00 pra já deixar pronto.",
        internal_notes: "OBSERVAÇÕES INTERNAS é bastidor (não vai pro público). Use pra pauta, links de referência, checklist, 'falar com fulano', etc.",
        meta_description: "META DESCRIÇÃO (SEO) é o textinho que pode aparecer no Google e quando compartilha link. Ex: \"Entenda como IA está mudando o varejo e o que isso significa pra preços e empregos.\"",
        keywords: "PALAVRAS-CHAVE (SEO) são tags separadas por vírgula. Ex: \"inteligência artificial, varejo, tecnologia, consumo\". Sem exagero: 5 a 10 tá ótimo."
      };

      function addHelp(labelEl, text) {
        if (!labelEl) return;
        if (labelEl.querySelector('.oxira-help')) return;
        const span = document.createElement('span');
        span.className = 'oxira-help';
        span.setAttribute('data-tip', text);
        span.textContent = '?';
        labelEl.appendChild(span);
      }

      function findLabel(fieldName) {
        // Tenta achar label para widgets normais e para SplitDateTime (id_published_date_0)
        const exact = document.querySelector('label[for="id_' + fieldName + '"]');
        if (exact) return exact;
        const starts = document.querySelector('label[for^="id_' + fieldName + '"]');
        if (starts) return starts;
        return null;
      }

      Object.keys(tips).forEach(function (k) {
        addHelp(findLabel(k), tips[k]);
      });

      // Placeholders simpáticos
      const title = document.getElementById('id_title');
      if (title && !title.placeholder) title.placeholder = 'Ex: Nova lei de zoneamento: o que muda na sua cidade';

      const subtitle = document.getElementById('id_subtitle');
      if (subtitle && !subtitle.placeholder) subtitle.placeholder = 'Ex: Entenda em 3 pontos e sem juridiquês';

      const meta = document.getElementById('id_meta_description');
      if (meta && !meta.placeholder) meta.placeholder = 'Ex: Resumo curto e chamativo (até ~160 caracteres)';

      const kw = document.getElementById('id_keywords');
      if (kw && !kw.placeholder) kw.placeholder = 'Ex: política, zoneamento, congresso, cidades';

      const notes = document.getElementById('id_internal_notes');
      if (notes && !notes.placeholder) notes.placeholder = 'Bastidores: links, pauta, checklist, fontes…';
    })();
  </script>
{% endblock %}
